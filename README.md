# Chaum-Pedersen ZKP Protocol

The Chaum-Pedersen protocol is a zero-knowledge proof protocol used to prove the equality of discrete logarithms without revealing the secret itself. It involves the following components:

- `x`: The secret (in our case, the "password" provided by the user).
- `y1`, `y2`: Public values generated by exponentiating the base values (`alpha` and `beta`) with the secret `x`.
- `r1`, `r2`: Random values used in the challenge generation.
- `c`: Challenge value generated by the server.
- `s`: Response value computed by the prover to prove knowledge of x.

> Note: The parameters for the Prime Order Subgroup are taken following the specifications for use in IKE, TLS, SSH, etc. for the 1024-bit MODP Group with 160-bit Prime Order Subgroup. [See here](https://www.rfc-editor.org/rfc/rfc5114.html#section-2.1).

## Protocol steps

1. Registration

- User provides a username and password (`x`).
- The client computes `y1` and `y2`:

```rust
let y1 = ZKP::exponentiate(&zkp.alpha, &password, &zkp.p);
let y2 = ZKP::exponentiate(&zkp.beta, &password, &zkp.p);
```

- These values are sent to the server in a `RegisterRequest`.

2. Authentication

- The client generates random values r1 and r2:

```rust
let k = ZKP::generate_random_below(&zkp.q);
let r1 = ZKP::exponentiate(&zkp.alpha, &k, &zkp.p);
let r2 = ZKP::exponentiate(&zkp.beta, &k, &zkp.p);
```

- These values are sent to the server in an `AuthChallengeRequest`.

3. Challenge Response

- The server generates a challenge `c` and sends it back to the client.
- The client computes the response `s`:

```rust
let s = zkp.solve(&k, &BigUint::from_bytes_be(&response.c), &password);
```

- This response is sent to the server in an `AuthAnswerRequest`.

4. Verification:

The server verifies the response and authenticates the user if the proof is valid.

## Running the Docker Compose Setup

### Prerequisites

- Ensure you have Docker and Docker Compose installed on your machine.
- Create an .env file in the root directory of your project to set up the necessary environment variables.

### Env variables

If you run it throught the specified docker-compose:

```bash
# .env
SERVER_ADDRESS=0.0.0.0:50051
CLIENT_ADDRESS=zkp-server:50051
```

### Building and running the containers

1. Build the Server and Client

```bash
docker-compose build --no-cache
```

2. Start the server

```bash
docker-compose up -d zkp-server
```

3. Start the client

```bash
docker-compose run zkp-client
```

This setup ensures that the client waits for user input interactively and connects to the server properly.

## Running Locally Without Docker

When running the server and client locally without Docker, you should use `127.0.0.1` for the addresses.

### Env variables

```bash
# .env
export SERVER_ADDRESS="127.0.0.1:50051"
export CLIENT_ADDRESS="http://127.0.0.1:50051"
```

1. Start the Server:

```bash
cargo run --bin server
```

2. Run the Client:

```bash
cargo run --bin client
```
